#!/bin/bash

# slacktest
# - written by azman@my1matrix.org
# - test script for functions in libmy1* libraries

# standard tool info
TOOL_NAME=`basename $0 .sh`
TOOL_PATH=`dirname $0`
TOOL_PATH=`cd $TOOL_PATH ; pwd`
TOOL_DESC="my1 Slackware Test Script"
TOOL_VERS="2019.06.00"

source_lib()
{
	local name=$1
	local full=$TOOL_PATH/$name
	[ ! -f "$full" ] && echo "Cannot find $full!" && exit 1
	. $full
}

source_lib libmy1slack
source_lib libmy1echo
source_lib libmy1file
source_lib libmy1get

call_debug()
{
	local info=`find_slack`
	local full=`echo $info | cut -d':' -f1`
	local logs=`echo $info | cut -d':' -f3`
	local tree=`echo $info | cut -d':' -f4`
	local main=`dirname $tree`
	local name=`echo $full | cut -d'-' -f1`
	local pack="$tree/$name"
	debug_msg "my1slack Library Name is $MY1_LIBNAME\n"
	debug_msg "my1slack Library Version is $MY1_LIBVERS\n"
	debug_msg "Command Call '$MY1_LIBCALL'\n"
	debug_msg "Slackware is $full @ $main\n"
	debug_msg "Slackware tree: $tree\n"
	debug_msg "Slackware sets: $pack\n"
	debug_msg "Slackware logs: $logs\n"
	echo
}

echo -e "\n$TOOL_NAME - $TOOL_DESC ($TOOL_VERS)\n"
debug_chk ; call_debug ; debug_chk no
if [ ! -z "$1" ] ; then
	echo -e "[SLACKTEST] Executing '$@'...\n"
	test_value="\"$1\" "
	shift
	for word in "$@" ; do
		test_value="$test_value \"$word\""
	done
	eval "$test_value"
	retval=$?
	echo -e "\n[SLACKTEST] Done.\n"
	exit $retval
fi
