#!/bin/bash

XFILE=`basename $0 .sh`
IFILE="$1"
OFILE="${IFILE%.*}.avi"

GOPTS="-sn" # disable subtitle
# audio options
AOPTS="-c:a libmp3lame -ar 48000 -ab 128k"
# simpler?
AOPTS="-c:a libmp3lame -qscale:a 4"
# video options
VOPTS="-c:v mpeg4 -vtag xvid -vf scale=704:304 -aspect 16:9 -vb 700k -r 25"
# simpler?
#VOPTS="-c:v mpeg4 -vtag xvid -qscale:v 3"
# if using external xvidcore?
#VOPTS="-c:v libxvid -vf scale=704:304 -aspect 16:9 -vb 700k -r 25"

echo "Input : $IFILE"
echo "Output: $OFILE"

ffmpeg -i ${IFILE} ${GOPTS} ${AOPTS} ${VOPTS} ${OFILE} 2>${XFILE}.log

# 2-pass?
#VOPTS="-c:v mpeg4 -vtag xvid -b:v 700k"
#INIT1="-y"
#INIT2=""
#PASS1="-pass 1 -an -f avi /dev/null"
#PASS2="-pass 2 -c:a libmp3lame -b:a 128k ${OFILE}"
#ffmpeg ${INIT1} -i ${IFILE} ${VOPTS} ${PASS1}
#ffmpeg ${INIT2} -i ${IFILE} ${VOPTS} ${PASS2}
